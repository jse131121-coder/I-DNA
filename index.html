<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>AND, JIN</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0;
  font-family: Pretendard, sans-serif;
  background: linear-gradient(#ffb6a8,#ffd7cc);
}
.page{display:none;padding:16px}
.active{display:block}
.card{
  background:#fff;
  border-radius:16px;
  padding:14px;
  margin-bottom:12px;
  box-shadow:0 8px 20px rgba(0,0,0,.08)
}
input,textarea{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid #ddd;
  margin-bottom:8px;
}
button{
  background:#ff6f61;
  border:none;
  color:#fff;
  padding:10px;
  border-radius:10px;
  cursor:pointer;
}
.nav{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:#ffeae3;
  display:flex;
  justify-content:space-around;
  padding:10px 0;
}
.badge{color:#ff6f61;font-size:12px}
.comment{margin-left:12px;font-size:13px}
.reply{margin-left:24px;font-size:12px;color:#555}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="page active">
  <div class="card">
    <h2>AND, JIN</h2>
    <input id="email" placeholder="ì´ë©”ì¼">
    <input id="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
    <button onclick="login()">ë¡œê·¸ì¸</button>
  </div>
</div>

<!-- HOME -->
<div id="home" class="page">
  <div class="card">
    <h2>BAEK AH JIN</h2>
    <img src="https://placehold.co/300x300" width="100%">
  </div>
</div>

<!-- COMMUNITY -->
<div id="community" class="page">
  <textarea id="postText" placeholder="ê¸€ ì‘ì„±"></textarea>
  <button onclick="addPost()">ë“±ë¡</button>
  <div id="posts"></div>
</div>

<!-- CHAT -->
<div id="chat" class="page">
  <div id="chatBox"></div>
  <input id="chatInput" placeholder="ë©”ì‹œì§€">
  <button onclick="sendChat()">ë³´ë‚´ê¸°</button>
</div>

<!-- LETTER -->
<div id="letter" class="page">
  <textarea id="letterText" placeholder="ë‚˜ì—ê²Œ í•˜ê³  ì‹¶ì€ ë§ì„ ë³´ë‚´ì¤˜!"></textarea>
  <button onclick="sendLetter()">ë³´ë‚´ê¸° âœˆï¸</button>
  <div id="letterList"></div>
</div>

<!-- NAV -->
<div class="nav">
  <div onclick="show('home')">í™ˆ</div>
  <div onclick="show('community')">ì»¤ë®¤ë‹ˆí‹°</div>
  <div onclick="show('chat')">ì±„íŒ…</div>
  <div onclick="show('letter')">í¸ì§€</div>
</div>

<script>
const firebaseConfig={
  apiKey:"YOUR_KEY",
  authDomain:"YOUR_PROJECT.firebaseapp.com",
  projectId:"YOUR_PROJECT_ID"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.firestore();
let role="fan";

function show(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function login(){
  auth.signInWithEmailAndPassword(email.value,password.value)
  .then(res=>{
    role = res.user.email.includes("ahjin") ? "artist" : "fan";
    show("home");
    loadPosts();
    loadChat();
    loadLetters();
  });
}

function addPost(){
  db.collection("posts").add({
    text:postText.value,
    role,
    time:Date.now()
  });
  postText.value="";
}

function loadPosts(){
  db.collection("posts").orderBy("time","desc")
  .onSnapshot(s=>{
    posts.innerHTML="";
    s.forEach(d=>{
      const p=d.data();
      let html=`<div class="card">
      <b>${p.role==="artist"?"ì•„ì§„ì´ ğŸ€ <span class='badge'>âœ”</span>":"fan"}</b>
      <p>${p.text}</p>
      <input placeholder="ëŒ“ê¸€" onkeydown="if(event.key==='Enter') addComment('${d.id}',this.value)">
      <div id="c_${d.id}"></div></div>`;
      posts.innerHTML+=html;
      loadComments(d.id);
    });
  });
}

function addComment(pid,text){
  db.collection("posts").doc(pid).collection("comments").add({
    text,role,time:Date.now()
  });
}

function loadComments(pid){
  db.collection("posts").doc(pid).collection("comments")
  .orderBy("time")
  .onSnapshot(s=>{
    const box=document.getElementById("c_"+pid);
    box.innerHTML="";
    s.forEach(d=>{
      const c=d.data();
      box.innerHTML+=`
      <div class="comment">
      ${c.role==="artist"?"ğŸ€ ì•„ì§„ì´":"fan"}: ${c.text}
      ${role==="artist" && c.role!=="artist"
        ? `<div class="reply" onclick="reply('${pid}','${d.id}')">â†³ ëŒ€ëŒ“ê¸€</div>`:""}
      </div>`;
    });
  });
}

function reply(pid,cid){
  const text=prompt("ëŒ€ëŒ“ê¸€");
  if(!text)return;
  db.collection("posts").doc(pid)
  .collection("comments").doc(cid)
  .collection("reply").add({
    text,time:Date.now()
  });
}

function sendChat(){
  db.collection("chat").add({
    text:chatInput.value,
    role,time:Date.now()
  });
  chatInput.value="";
}

function loadChat(){
  db.collection("chat").orderBy("time")
  .onSnapshot(s=>{
    chatBox.innerHTML="";
    s.forEach(d=>{
      chatBox.innerHTML+=`<p>${d.data().role}: ${d.data().text}</p>`;
    });
  });
}

function sendLetter(){
  db.collection("letters").add({
    text:letterText.value,
    time:Date.now()
  });
  letterText.value="";
}

function loadLetters(){
  if(role!=="artist")return;
  db.collection("letters").orderBy("time","desc")
  .onSnapshot(s=>{
    letterList.innerHTML="";
    s.forEach(d=>{
      letterList.innerHTML+=`<div class="card">${d.data().text}</div>`;
    });
  });
}
</script>
</body>
</html>
