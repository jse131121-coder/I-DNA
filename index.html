<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Community MVP</title>
  <style>
    body { margin:0; font-family: Arial, sans-serif; background:#f6f6f6; }
    .login-screen { height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; gap:12px; }
    input, button, textarea { padding:10px; border-radius:8px; border:1px solid #ccc; }
    button { cursor:pointer; }

    /* 공통 */
    .post { background:#fff; border-radius:12px; padding:12px; margin-bottom:12px; }
    .post-header { display:flex; align-items:center; gap:10px; margin-bottom:8px; }
    .avatar { width:40px; height:40px; border-radius:50%; background:#ddd; object-fit:cover; }
    .badge { font-size:11px; padding:2px 6px; border-radius:6px; background:#eaeaea; }
    .badge.artist { background:#c9f7c9; }
    .content { white-space: pre-wrap; }

    /* 채팅 */
    .chat-box { padding:12px; }
    .bubble { max-width:70%; padding:10px; border-radius:14px; margin:6px 0; white-space: pre-wrap; }
    .bubble.fan { background:#fff; margin-left:auto; border-top-right-radius:0; }
    .bubble.artist { background:#e9ffe9; margin-right:auto; border-top-left-radius:0; }

    .readonly { opacity:0.6; pointer-events:none; }
  </style>
</head>
<body>

<div id="login" class="login-screen">
  <h2>LOGIN</h2>
  <input id="id" placeholder="ID" />
  <input id="pw" type="password" placeholder="PW" />
  <button onclick="login()">로그인</button>
  <button onclick="guest()">로그인 건너뛰기 (읽기 전용)</button>
</div>

<div id="app" style="display:none; padding:16px;">
  <h2>COMMUNITY</h2>

  <!-- 피드 / 공지 / 건의 -->
  <div id="posts"></div>

  <!-- 채팅 -->
  <h3>CHAT</h3>
  <div id="chat" class="chat-box"></div>
  <textarea id="chatInput" placeholder="메시지 입력"></textarea>
  <button onclick="sendChat()">보내기</button>
</div>

<script>
const users = JSON.parse(localStorage.getItem('users') || '{"yerin":{"pw":"1234","role":"artist","name":"예린","avatar":""}}');
let currentUser = null;
let readOnly = false;

function login(){
  const id=document.getElementById('id').value;
  const pw=document.getElementById('pw').value;
  if(users[id] && users[id].pw===pw){
    currentUser={id,...users[id]};
    start();
  } else alert('로그인 실패');
}
function guest(){ readOnly=true; start(); }

function start(){
  document.getElementById('login').style.display='none';
  document.getElementById('app').style.display='block';
  if(readOnly) document.getElementById('app').classList.add('readonly');
  renderPosts(); renderChat();
}

/* 게시글 */
function renderPosts(){
  const posts=JSON.parse(localStorage.getItem('posts')||'[]');
  const box=document.getElementById('posts'); box.innerHTML='';
  posts.forEach(p=>{
    const d=document.createElement('div'); d.className='post';
    d.innerHTML=`<div class='post-header'>
      <img class='avatar' src='${p.avatar||""}' />
      <b>${p.name}</b>
      <span class='badge ${p.role}'>${p.role.toUpperCase()}</span>
    </div>
    <div class='content'>${p.text}</div>`;
    if(p.img) d.innerHTML+=`<img src='${p.img}' style='width:100%;border-radius:8px;margin-top:6px;'/>`;
    box.appendChild(d);
  });
}

/* 채팅 */
function renderChat(){
  const chats=JSON.parse(localStorage.getItem('chats')||'[]');
  const box=document.getElementById('chat'); box.innerHTML='';
  chats.forEach(c=>{
    const b=document.createElement('div');
    b.className=`bubble ${c.role}`;
    b.innerText=c.text;
    box.appendChild(b);
  });
}
function sendChat(){
  if(readOnly) return;
  const t=document.getElementById('chatInput').value;
  if(!t) return;
  const chats=JSON.parse(localStorage.getItem('chats')||'[]');
  chats.push({ text:t, role:currentUser.role });
  localStorage.setItem('chats',JSON.stringify(chats));
  document.getElementById('chatInput').value='';
  renderChat();
}
</script>
</body>
</html>


